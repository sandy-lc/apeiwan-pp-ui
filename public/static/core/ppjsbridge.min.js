/*!@apeiwan/ppjsbridge beta@0.1.0*/
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).PPJSBridge=t()}(this,(function(){"use strict";function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}function t(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function n(e){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?t(Object(r),!0).forEach((function(t){var n,i,o;n=e,o=r[i=t],i in n?Object.defineProperty(n,i,{value:o,enumerable:!0,configurable:!0,writable:!0}):n[i]=o})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):t(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function r(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)){var n=[],r=!0,i=!1,o=void 0;try{for(var s,a=e[Symbol.iterator]();!(r=(s=a.next()).done)&&(n.push(s.value),!t||n.length!==t);r=!0);}catch(e){i=!0,o=e}finally{try{r||null==a.return||a.return()}finally{if(i)throw o}}return n}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var i,o=window.navigator.userAgent,s=o.match(/(Android);?[\s\/]+([\d.]+)?/),a=o.match(/(iPad).*OS\s([\d_]+)/),u=o.match(/(iPod)(.*OS\s([\d_]+))?/),c=!a&&o.match(/(iPhone\sOS|iOS)\s([\d_]+)/),f=/pipipeiwan/i.test(window.navigator.userAgent),d="1.1.7",l=s?"android":a||u||c?"ios":"pc",p="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},v=new(function(e){!function(t){function n(){}var r=n.prototype,i=t.EventEmitter;function o(e,t){for(var n=e.length;n--;)if(e[n].listener===t)return n;return-1}function s(e){return function(){return this[e].apply(this,arguments)}}r.getListeners=function(e){var t,n,r=this._getEvents();if(e instanceof RegExp)for(n in t={},r)r.hasOwnProperty(n)&&e.test(n)&&(t[n]=r[n]);else t=r[e]||(r[e]=[]);return t},r.flattenListeners=function(e){var t,n=[];for(t=0;t<e.length;t+=1)n.push(e[t].listener);return n},r.getListenersAsObject=function(e){var t,n=this.getListeners(e);return n instanceof Array&&((t={})[e]=n),t||n},r.addListener=function(e,t){if(!function e(t){return"function"==typeof t||t instanceof RegExp||!(!t||"object"!=typeof t)&&e(t.listener)}(t))throw new TypeError("listener must be a function");var n,r=this.getListenersAsObject(e),i="object"==typeof t;for(n in r)r.hasOwnProperty(n)&&-1===o(r[n],t)&&r[n].push(i?t:{listener:t,once:!1});return this},r.on=s("addListener"),r.addOnceListener=function(e,t){return this.addListener(e,{listener:t,once:!0})},r.once=s("addOnceListener"),r.defineEvent=function(e){return this.getListeners(e),this},r.defineEvents=function(e){for(var t=0;t<e.length;t+=1)this.defineEvent(e[t]);return this},r.removeListener=function(e,t){var n,r,i=this.getListenersAsObject(e);for(r in i)i.hasOwnProperty(r)&&-1!==(n=o(i[r],t))&&i[r].splice(n,1);return this},r.off=s("removeListener"),r.addListeners=function(e,t){return this.manipulateListeners(!1,e,t)},r.removeListeners=function(e,t){return this.manipulateListeners(!0,e,t)},r.manipulateListeners=function(e,t,n){var r,i,o=e?this.removeListener:this.addListener,s=e?this.removeListeners:this.addListeners;if("object"!=typeof t||t instanceof RegExp)for(r=n.length;r--;)o.call(this,t,n[r]);else for(r in t)t.hasOwnProperty(r)&&(i=t[r])&&("function"==typeof i?o.call(this,r,i):s.call(this,r,i));return this},r.removeEvent=function(e){var t,n=typeof e,r=this._getEvents();if("string"===n)delete r[e];else if(e instanceof RegExp)for(t in r)r.hasOwnProperty(t)&&e.test(t)&&delete r[t];else delete this._events;return this},r.removeAllListeners=s("removeEvent"),r.emitEvent=function(e,t){var n,r,i,o,s=this.getListenersAsObject(e);for(o in s)if(s.hasOwnProperty(o))for(n=s[o].slice(0),i=0;i<n.length;i++)!0===(r=n[i]).once&&this.removeListener(e,r.listener),r.listener.apply(this,t||[])===this._getOnceReturnValue()&&this.removeListener(e,r.listener);return this},r.trigger=s("emitEvent"),r.emit=function(e){var t=Array.prototype.slice.call(arguments,1);return this.emitEvent(e,t)},r.setOnceReturnValue=function(e){return this._onceReturnValue=e,this},r._getOnceReturnValue=function(){return!this.hasOwnProperty("_onceReturnValue")||this._onceReturnValue},r._getEvents=function(){return this._events||(this._events={})},n.noConflict=function(){return t.EventEmitter=i,n},e.exports?e.exports=n:t.EventEmitter=n}("undefined"!=typeof window?window:p||{})}(i={exports:{}}),i.exports),h=function(e,t){var n,r=String(e).split(".").map((function(e){return parseInt(e)})),i=String(t).split(".").map((function(e){return parseInt(e)})),o=Math.max(r.length,i.length);if(null==e||null==t)throw new Error;if(0==e.length&&0==t.length)return 0;if(0==e.length)return-1;if(0==t.length)return 1;for(var s=0;s<o&&0==(n=a(r[s],i[s]));s++);return n;function a(e,t){return"number"!=typeof e&&(e=0),"number"!=typeof t&&(t=0),t<e?1:e<t?-1:0}},g=function(t){var n=(window.FLPPJSBridge||{}).version;if(!n)return!1;if(f){if("ios"===l){var r=("object"===e(t)?t.ios:t)||d;return-1<h(n,r)}var i=("object"===e(t)?t.android:t)||d;return-1<h(n,i)}return!1},m=function(){return f?window.PPJSBridgeReady?sessionStorage.getItem("token"):localStorage.getItem("token"):""},w=function(){var t=window.FLPPJSBridge||{};return f&&"object"===e(window.FLPPJSBridge)?(t.env+"").toUpperCase()||void 0:""},y=function(){var t=window.FLPPJSBridge||{};return f&&"object"===e(window.FLPPJSBridge)?t.version:""},b=function(){return f?!!sessionStorage.getItem("token"):""},P=function(){return n({},window.FLPPJSBridge,{token:m(),env:w(),version:y(),isLogin:b(),os:l})},O=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},n=e.action;t.handle?t.handle(e,P()):("success"===n?t.success&&t.success(e,P()):t.fail&&t.fail(e,P()),t.complete&&t.complete(e,P()))},L=function(e){var t=["a","b","c","d","e","f","g","h","i","g","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"][Math.round(25*Math.random())]+(65536*(1+Math.random())|0).toString(16).substring(1);return v.addOnceListener(t,(function(t){var n=e.cmd;"func.ready"!==n&&"func.login"!==n||window.FLPPJSBridge||(window.FLPPJSBridge=t.data),O(t,e)})),window[t]=function(e){v.emitEvent(t,[e])},t},S=function(e){if(t=e,r={},f?t.version&&!g(t.version)&&(r={message:"not use api,because app notSupport",action:"notSupport"}):r={message:"not pipiapp environment",action:"notApp"},!r.action||(O(r,t),0)){var t,r,i,o,s=e.handle,a=e.success,u=e.fail,c=e.complete,d={cmd:e.cmd};(s||a||u||c)&&(d.handle=L(e)),e.data&&(d.data=e.data),-1!==(o=(i=n({},d)).cmd).indexOf(".")&&(o=o.split("."),i.api=o[1],o=o[0]),"ios"===l?window.webkit.messageHandlers[o].postMessage(i):"android"===l&&window["flppAndroid"+o].postMessage(JSON.stringify(i))}},j=function(t){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"&",r="";for(var i in t){var o=t[i];""!==o&&(r+=i+"="+encodeURIComponent("object"===e(o)?JSON.stringify(o):o)+n)}return r?r.substr(0,r.length-1):""},E=function(e){var t=function(e){var t=window.location.hash,n=window.location.search;if(e){var r=e.indexOf("#"),i=e.indexOf("?");if(t=-1!==r?e.substr(r):"",i<r||-1!==i&&-1===r){var o=i<r?r-i:e.length;n=e.substr(i,o)}else n=""}return{hash_str:t,search_str:n}}(e),n=t.hash_str,r=t.search_str,i=n.indexOf("?");n=-1!==i?n.substr(i+1)+"&":"";var o=r.indexOf("?");-1!==o&&(r=r.substr(o+1));var s={};if(-1!==i||-1!==o)for(var a=(n+r).split("&"),u=0;u<a.length;u++){var c=a[u].split("=");if(c[0]){var f="";try{f=decodeURIComponent(c[1])}catch(e){f=c[1]}s[c[0]]=f}}return s},x="func.login",A="func.goBack",_="func.ready",J="func.openAppPage",R={};function B(e,t){var n=t.data,r=void 0===n?{}:n;r.token&&R.set(r.token),e&&e({data:P(),action:t.action,message:t.message},P())}return R.format=function(e){return""===e||"null"===e?"":e},R.set=function(e){var t=R.format(e);t&&sessionStorage.setItem("token",t)},{os:l,isPiPiApp:f,invoke:S,isCanIUse:g,login:function(e){S({cmd:x,handle:function(t){B(e,t)},version:"1.2.9"})},ready:function(e){function t(){window.FLPPJSBridge?B(e,{data:window.FLPPJSBridge,action:"success",message:""}):S({cmd:_,handle:function(t){B(e,t)}})}window.PPJSBridgeReady=!0,window.FLPPJSBridge?B(e,{data:window.FLPPJSBridge,action:"success",message:""}):"complete"===document.readyState?t():document.addEventListener("DOMContentLoaded",(function(){t()}),!0)},openWindow:function(t){if(f){var i=t.version||"",o={},s={},a={},u=t.ios,c=t.android;"object"===e(t.android)&&(o.android=t.android.version||"",s=t.android.query||{},c=t.android.url),"object"===e(t.ios)&&(o.ios=t.ios.version||"",a=t.ios.query||{},u=t.ios.url),i=i||o;var d=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"&",r=-1!==e.indexOf("?")?n:"?";return e+(t?r:"")+t};if(t.url){var p=t.url;a={},c={};var v=E(p),h={};void 0!==v.hideNavi&&(h.hideNavi=v.hideNavi),void 0!==v.title&&(h.title=v.title);var g=j(h);g=g?"&"+g:"",u="FLWebPageViewController?urlString="+encodeURIComponent(t.url)+g,c="WebViewActivity?url="+encodeURIComponent(t.url)}var m=function(){var e=t.query,i={},o={ios:{},android:{}};for(var s in e){var a=s+"";if(-1!==a.indexOf("["))for(var u=a.substr(1,a.length-2).split(","),c=0;c<u.length;c++){var f=r(u[c].split(":"),2),d=f[0],p=f[1];o[d][p]=e[s]}else i[s]=e[s]}return n({},i,{},o[l])};return S({version:i,data:{para:JSON.stringify({ios:{ios_route:d(u,j(n({},a,{},m())))},android:{androidRoute:d(c,j(n({},s,{},m())))}}[l])},cmd:J,handle:t.handle})}t.href&&(window.location.href=t.href)},getToken:m,getVersion:y,getEnv:w,getApp:P,isLogin:b,back:function(){S({cmd:A})},getStitchingUrlParams:j,getRequestUrlParam:E}}));
